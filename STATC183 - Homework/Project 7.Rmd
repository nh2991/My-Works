---
output:
  pdf_document: default
  html_document: default
---

---
title: \textbf{Project 7}
author: "Juwon Lee, Economics and Statistics, UCLA"
date: "2023-05-10"
output: 
  pdf_document:
    latex_engine: xelatex
---

tinytex::install_tinytex()

### a.

```{r}

hw <- read.csv("/Users/user/Desktop/Yonsei/Junior/3-2/Statistical Models in Finance/stockData.csv",sep=',', header=T)

r_hw7 <- (hw[-1, 3:ncol(hw)]-hw[-nrow(hw),3:ncol(hw)])/hw[-nrow(hw),3:ncol(hw)]

covmat_hw7 <- cov(r_hw7)
beta_hw7 <- covmat_hw7[1,-1] / covmat_hw7[1,1]

r_tech <- data.frame(r_hw7$AAPL, r_hw7$IBM, r_hw7$GOOGL, r_hw7$META, r_hw7$NFLX, r_hw7$AMZN, r_hw7$TSLA)

r_custom <- data.frame(r_hw7$BABA, r_hw7$NKE, r_hw7$MCD, r_hw7$WMT, r_hw7$KO, r_hw7$PEP, r_hw7$XOM, r_hw7$CVX,
                       r_hw7$SHEL, r_hw7$GE, r_hw7$JNJ, r_hw7$PFE, r_hw7$PKX, r_hw7$BIDU)

r_finance <- data.frame(r_hw7$BRK.A, r_hw7$BRK.B, r_hw7$V, r_hw7$JPM, r_hw7$MA, r_hw7$C.PJ, r_hw7$MS, r_hw7$HSBC,
                        r_hw7$BA)

```

\noindent Tech group (7) = AAPL, IBM, GOOGL, META, NFLX, AMZN, TSLA  
Customer Item group (14) = BABA, NKE, MCD, WMT, KO, PEP, XOM, CVX, SHEL, GE, JNJ, PFE, PKX, BIDU  
Financial group (9) = BRK.A, BRK.B, V, JPM, MA, C.PJ, MS, HSBC, BA

```{r}

r_group <- cbind(r_hw7$X.GSPC, r_tech, r_custom, r_finance)

rrr_hw7 <- r_group[,-c(1,which(beta_hw7<0)+1)]

b_hw7 <- rep(0, 7)

tech <- (rrr_hw7[,1] + rrr_hw7[,2] + rrr_hw7[,3] + rrr_hw7[,4] +rrr_hw7[,5] + rrr_hw7[,6] + rrr_hw7[,7]) / 7

lm_tech <- lm(data=r_hw7, formula=tech~r_hw7[,1])

b_tech <- lm_tech$coefficients[2]

custom <- (rrr_hw7[,8] + rrr_hw7[,9] + rrr_hw7[,10] + rrr_hw7[,11] +rrr_hw7[,12] + rrr_hw7[,13] + rrr_hw7[,14]
           + rrr_hw7[,15] + rrr_hw7[,16] + rrr_hw7[,17] + rrr_hw7[,18] + rrr_hw7[,19] + rrr_hw7[,20] + rrr_hw7[,21]) / 14

lm_custom <- lm(data=r_hw7, formula=custom~r_hw7[,1])

b_custom <- lm_custom$coefficients[2]

finance <- (rrr_hw7[,22] + rrr_hw7[,23] + rrr_hw7[,24] + rrr_hw7[,25] +rrr_hw7[,26] + rrr_hw7[,27] + rrr_hw7[,28]
            + rrr_hw7[,29] + rrr_hw7[,30]) / 9

lm_finance <- lm(data=r_hw7, formula=finance~r_hw7[,1])

b_finance <- lm_tech$coefficients[2]

b_tech ; b_custom ; b_finance

cov(tech, custom) ; cov(tech, finance) ; cov(custom, finance)

```

\noindent Thus, $b_t = 1.19856, b_c = 0.9369151, b_f = 1.19856$. And we know correlation between group.
Then if we know about beta, then we can know A and C 
(N1 = 7, N2 = 14, N3 = 9, sigma_i = for stock, rho_ii = for industry), 
then we can figure phi, then z_i can be computed.
Then we can find mean and sd, and add it to plot of project 6.

```{r}

cor_11 <- (sum(cor(r_tech)) - length(r_tech)) / (length(r_tech) * (length(r_tech) - 1))
cor_22 <- (sum(cor(r_custom)) - length(r_custom)) / (length(r_custom) * (length(r_custom) - 1))
cor_33 <- (sum(cor(r_finance)) - length(r_finance)) / (length(r_finance) * (length(r_finance) - 1))

A1 <- c(1 + 7 * cor_11 / (1 - cor_11), 14 * cor(custom, tech) / (1 - cor_22), 9 * cor(finance, tech) / (1 - cor_33))

A2 <- c(7 * cor(tech, custom) / (1 - cor_11), 1 + (14 * cor_22) / (1 - cor_22), 9 * cor(finance, custom) / (1 - cor_33))

A3 <- c(7 * cor(tech, finance) / (1 - cor_11), (14 * cor(custom, finance) / (1 - cor_22)), 1 + (9 * cor_33) / (1 - cor_33))

length(r_tech)

mean_tech <- rep(0, length(r_tech))
sd_tech <- rep(0, length(r_tech))

for (i in 1:length(r_tech)) {
  mean_tech[i] <- mean(r_tech[,i])  
  sd_tech[i] <- sd(r_tech[,i])
}

mean_custom <- rep(0, length(r_custom))
sd_custom <- rep(0, length(r_custom))

for (i in 1:length(r_custom)) {
  mean_custom[i] <- mean(r_custom[,i])
  sd_custom[i] <- sd(r_custom[,i])
}

mean_finance <- rep(0, length(r_finance))
sd_finance <- rep(0, length(r_finance))

for (i in 1:length(r_finance)) {
  mean_finance[i] <- mean(r_finance[,i])
  sd_finance[i] <- sd(r_finance[,i])
}

rf_hw7 <- 0.001

c_tech <- sum((mean_tech - rf_hw7) / (sd_tech * (1 - cor_11)))
c_custom <- sum((mean_custom - rf_hw7) / (sd_custom) * (1 - cor_22))
c_finance <- sum((mean_finance - rf_hw7) / (sd_finance) * (1 - cor_33))

A <- cbind(A1, A2, A3)
C <- c(c_tech, c_custom, c_finance)

phi <- solve(A) %*% C

phi


C_tech <- t(c(cor_11, cor(tech, custom), cor(tech, finance))) %*% phi
C_custom <- t(c(cor(custom, tech), cor_22, cor(custom, finance))) %*% phi
C_finance <- t(c(cor(finance, tech), cor(finance, custom), cor_33)) %*% phi

z_tech <- 1 / (sd_tech * (1 - cor_11)) * ((mean_tech - rf_hw7) / sd_tech - C_tech)
z_custom <- 1 / (sd_custom * (1 - cor_22)) * ((mean_custom - rf_hw7) / sd_custom - C_custom)
z_finance <- 1 / (sd_finance * (1 - cor_33)) * ((mean_finance - rf_hw7) / sd_finance - C_finance)

sumofz <- sum(z_tech, z_custom, z_finance)

x_tech <- z_tech / sumofz
x_custom <- z_custom / sumofz
x_finance <- z_finance / sumofz

```

\noindent Thus, we find the percentage of investment.

```{r}

x <- c(x_tech, x_custom, x_finance)

meanofmodel <- t(colMeans(r_group)[-1]) %*% x
varofmodel <- t(x) %*% cov(r_group[-1]) %*% x

```

\noindent Now, if we plot this,

```{r echo=FALSE}

hw <- read.csv("/Users/user/Desktop/Yonsei/Junior/3-2/Statistical Models in Finance/stockData.csv",sep=',', header=T)

r_hw6 <- (hw[-1, 3:ncol(hw)]-hw[-nrow(hw),3:ncol(hw)])/hw[-nrow(hw),3:ncol(hw)]

covmat_hw6 <- cov(r_hw6)
beta_hw6 <- covmat_hw6[1,-1] / covmat_hw6[1,1]

rrr_hw6 <- r_hw6[,-c(1,which(beta_hw6<0)+1)]

beta_new_hw6 <- rep(0,ncol(rrr_hw6))
alpha_hw6 <- rep(0,ncol(rrr_hw6))
mse_hw6 <- rep(0,ncol(rrr_hw6))
Ribar_hw6 <- rep(0,ncol(rrr_hw6))
Ratio_hw6 <- rep(0,ncol(rrr_hw6))
stock_hw6 <- rep(0,ncol(rrr_hw6))

rf_hw6 <- 0.001

for(i in 1:ncol(rrr_hw6)) {
  q_hw6 <- lm(data=rrr_hw6, formula=rrr_hw6[,i]~r_hw6[,1])
  beta_new_hw6[i] <- q_hw6$coefficients[2]
  alpha_hw6[i] <- q_hw6$coefficients[1]
  mse_hw6[i] <- summary(q_hw6)$sigma^2
  Ribar_hw6[i] <- q_hw6$coefficients[1] + q_hw6$coefficients[2] * mean(r_hw6[,1])
  Ratio_hw6[i] <- (Ribar_hw6[i] - rf_hw6) / beta_new_hw6[i]
  stock_hw6[i] <- i
}

xx_hw6 <- (cbind(stock_hw6, alpha_hw6, beta_new_hw6, Ribar_hw6, mse_hw6, Ratio_hw6))

A_hw6 <- xx_hw6[order(-xx_hw6[,6]),]

col1_hw6 <- rep(0,nrow(A_hw6))
col2_hw6 <- rep(0,nrow(A_hw6))
col3_hw6 <- rep(0,nrow(A_hw6))
col4_hw6 <- rep(0,nrow(A_hw6))
col5_hw6 <- rep(0,nrow(A_hw6)) 

col1_hw6 <- (A_hw6[,4]-rf_hw6)*A_hw6[,3]/A_hw6[,5]
col3_hw6 <- A_hw6[,3]^2 / A_hw6[,5]
for(i in 1:nrow(A_hw6)) {
  col2_hw6[i] <- sum(col1_hw6[1:i])
  col4_hw6[i] <- sum(col3_hw6[1:i])
}

for(i in 1:nrow(A_hw6)) {
  col5_hw6[i] <- var(r_hw6[,1])*col2_hw6[i]/(1+var(r_hw6[,1])*col4_hw6[i])
}

z_short_hw6 <- (A_hw6[,3]/A_hw6[,5])*(A_hw6[,6]-col5_hw6[nrow(A_hw6)])
x_short_hw6 <- z_short_hw6/sum(z_short_hw6)

Weights_with_short_hw6 <- cbind(A_hw6, col1_hw6, col2_hw6, col3_hw6, col4_hw6, col5_hw6, z_short_hw6, x_short_hw6)

table1_hw6 <- cbind(A_hw6, col1_hw6, col2_hw6, col3_hw6, col4_hw6, col5_hw6)
table2_hw6 <- table1_hw6[1:which(col5_hw6==max(col5_hw6)),]

z_no_short_hw6 <- (table2_hw6[,3]/table2_hw6[,5]) * (table2_hw6[,6] - max(col5_hw6))
  
x_no_short_hw6 <- z_no_short_hw6 / sum(z_no_short_hw6)
  
Weights_no_short_hw6 <- cbind(table2_hw6, z_no_short_hw6, x_no_short_hw6)

r_2_hw6 <- r_hw6[,A_hw6[,1]]

means_hw6 <- colMeans(r_2_hw6)
covmat_hw6 <- cov(r_2_hw6)
corrmat_hw6 <- cor(r_2_hw6)
variances_hw6 <- diag(covmat_hw6)
stdev_hw6 <- diag(covmat_hw6)^.5

ones_hw6 <- rep(1,30)

A_plot_hw6 <- sum(covmat_hw6^(-1) * means_hw6)
A2_plot_hw6 <- t(ones_hw6) %*% solve(covmat_hw6) %*% means_hw6
B_plot_hw6 <- sum(covmat_hw6^(-1) * means_hw6 * means_hw6)
B2_plot_hw6 <- t(means_hw6) %*% solve(covmat_hw6) %*% means_hw6
C_plot_hw6 <- sum(covmat_hw6^(-1))
C2_plot_hw6 <- t(ones_hw6) %*% solve(covmat_hw6) %*% ones_hw6
D_plot_hw6 <- B_plot_hw6 * C_plot_hw6 - A_plot_hw6 * A_plot_hw6
D2_plot_hw6 <- B2_plot_hw6 * C2_plot_hw6 - A2_plot_hw6 * A2_plot_hw6

x_plot_hw6 <- seq(-0.1,0.1, 0.001)
sigma_squared_hw6 <- (C2_plot_hw6 * x_plot_hw6 * x_plot_hw6 - 2 * A2_plot_hw6 * x_plot_hw6 + B2_plot_hw6) / D2_plot_hw6

### 1. Short sales are allowed
mean_with_short_hw6 <- t(as.matrix(A_hw6[,4])) %*% as.matrix(Weights_with_short_hw6[,13])
var_with_short_hw6 <- t(as.matrix(Weights_with_short_hw6[,13])) %*% covmat_hw6 %*% as.matrix(Weights_with_short_hw6[,13])

### 2. Short sales are NOT allowed
covmat_no_short_hw6 <- cov(r_2_hw6[,1:11])

mean_no_short_hw6 <- t(as.matrix(A_hw6[1:11,4])) %*% as.matrix(Weights_no_short_hw6[,13])
var_no_short_hw6 <- t(as.matrix(Weights_no_short_hw6[,13])) %*% covmat_no_short_hw6 %*% as.matrix(Weights_no_short_hw6[,13])

average_corr_hw6 <- (sum(cor(r_hw6[-1])) - 30) / (length(r_hw6[-1]) * (length(r_hw6[-1]) - 1))

Ribar_Rf <- Ribar_hw6 - rf_hw6

sigma_i_hw6 <- rep(0, ncol(rrr_hw6))
corr_rate_hw6 <- rep(0, ncol(rrr_hw6))
stacked_i_hw6 <- rep(0, ncol(rrr_hw6))
c_i_hw6 <- rep(0, ncol(rrr_hw6))
ratio_sigma <- rep(0, ncol(rrr_hw6))

for(i in 1:ncol(rrr_hw6)) {
  sigma_i_hw6[i] <- sd(rrr_hw6[,i])
  corr_rate_hw6[i] <- average_corr_hw6 / (1 - average_corr_hw6 + i * average_corr_hw6)
  ratio_sigma[i] <- Ribar_Rf[i] / sigma_i_hw6[i]
  stacked_i_hw6[i] <- sum(ratio_sigma[1:i])
  c_i_hw6[i] <- (1 / (1 - average_corr_hw6) * sigma_i_hw6[i]) * stacked_i_hw6[i]
}

table_ccm_hw6 <- cbind(stock_hw6, Ribar_hw6, Ribar_Rf, sigma_i_hw6, ratio_sigma, corr_rate_hw6, stacked_i_hw6, c_i_hw6)

### 1. Short sales are allowed

z_with_short_ccm_hw6 <- rep(0, ncol(rrr_hw6))

for (i in 1:ncol(rrr_hw6)) {
  z_with_short_ccm_hw6[i] <- 1 / ((1 - average_corr_hw6) * sigma_i_hw6[i]) * (ratio_sigma[i] - c_i_hw6[i])
}

x_with_short_ccm_hw6 <- z_with_short_ccm_hw6 / sum(z_with_short_ccm_hw6)

mean_with_short_ccm_hw6 <- t(as.matrix(Ribar_hw6)) %*% as.matrix(x_with_short_ccm_hw6)
var_with_short_ccm_hw6 <- t(as.matrix(x_with_short_ccm_hw6)) %*% covmat_hw6 %*% as.matrix(x_with_short_ccm_hw6)

### 2. Short sales are NOT allowed

table_ccm_2_hw6 <- table_ccm_hw6[order(-table_ccm_hw6[,5]),]

table_ccm_3_hw6 <- cbind(table_ccm_2_hw6, table_ccm_2_hw6[,5] - table_ccm_2_hw6[,8])

table_ccm_4_hw6 <- table_ccm_3_hw6[order(-table_ccm_3_hw6[,9]),]

table_ccm_4_hw6[,1][14:30]

z_no_short_ccm_hw6 <- rep(0, 13)

for (i in 1:13) {
  z_no_short_ccm_hw6[i] <- (1 / (1-average_corr_hw6) * table_ccm_4_hw6[,4][i]) * (table_ccm_4_hw6[,7][i] - table_ccm_4_hw6[,8][i])
}

x_no_short_ccm_hw6 <- z_no_short_ccm_hw6 / sum(z_no_short_ccm_hw6)

covmat_no_short_hw6 <- cov(r_2_hw6[,-table_ccm_4_hw6[,1][14:30]])

mean_no_short_ccm_hw6 <- t(as.matrix(table_ccm_2_hw6[1:13,2])) %*% as.matrix(x_no_short_ccm_hw6)
var_no_short_ccm_hw6 <- t(as.matrix(x_no_short_ccm_hw6)) %*% covmat_no_short_hw6 %*% as.matrix(x_no_short_ccm_hw6)

```

```{r}
plot(sigma_squared_hw6^0.5, x_plot_hw6, type='l',  ylab="Portfolio expected return", xlab="Portfolio standard deviation")
points(variances_hw6^0.5, means_hw6)
points(var(r_hw6$X.GSPC)^0.5, mean(r_hw6$X.GSPC), col='blue', pch=15)
points(var_with_short_hw6^0.5, mean_with_short_hw6, col='red', pch=15)
points(var_no_short_hw6^0.5, mean_no_short_hw6, col='red', pch=15)
points(var_no_short_ccm_hw6^0.5, mean_no_short_ccm_hw6, col='orange', pch=15)
points(var_with_short_ccm_hw6^0.5, mean_with_short_ccm_hw6, col='orange', pch=15)
text(0.03, 0.045, "(CCM) NOT \n Allowed", col='orange')
text(0.065, -0.03, "(CCM) Allowed", col='orange')
text(0.037, -0.012, "S&P 500", col='blue')
text(0.057, 0.06, "Allowed", col='red')
text(0.042, 0.045, "NOT \n Allowed", col='red')

points(varofmodel^0.5, meanofmodel, col='purple', pch=15)
text(0.028, -0.01, "Multi- \n group", col='purple')

```

\newpage

### b.

#### 1.

```{r}

x
x_short_hw6
x_no_short_hw6
x_with_short_ccm_hw6
x_no_short_ccm_hw6

par(mfrow=c(3,2))
plot(as.matrix(r_group[-1]) %*% x, type='l', main='Time Plot', xlab='Time (Months)', ylab='Return')
plot(as.matrix(rrr_hw6[,table1_hw6[,1]]) %*% x_short_hw6, type='l', main='Time Plot (Short sales are allowed)', xlab='Time (Months)', ylab='Return')
plot(as.matrix(rrr_hw6[,table2_hw6[,1]]) %*% x_no_short_hw6, type='l', main='Time Plot (Short sales are NOT allowed)', xlab='Time (Months)', ylab='Return')
plot(as.matrix(r_hw6[,-1]) %*% x_with_short_ccm_hw6, type='l', main='Time Plot (CCM, Short sales are allowed)', xlab='Time (Months)', ylab='Return')
plot(as.matrix(rrr_hw6[,table_ccm_4_hw6[1:13,1]]) %*% x_no_short_ccm_hw6, type='l', main='Time Plot (CCM, Short sales are NOT allowed)', xlab='Time (Months)', ylab='Return')

```

#### 2.

\noindent 1. Multi-group Model.

\noindent $(1+ r_g)^{59} = (1 + r_1) (1 + r_2) ... (1 + r_{59})$, so that  
$r_g = [ (1 + r_1) (1 + r_2) ... (1 + r_{59})]^{\frac{1}{59}} - 1$.

```{r}

prod(as.matrix(r_group[-1]) %*% x + 1)^(1/59) - 1

```

\noindent Thus, $r_g = 0.01530617$.  

\noindent 2. General model when short sales are allowed.  

```{r}

prod(as.matrix(rrr_hw6[,table1_hw6[,1]]) %*% x_short_hw6 + 1)^(1/60) - 1

```

\noindent Thus, $r_g = 0.03812507$.  

\noindent 3. General model when short sales are NOT allowed.

```{r}

prod(as.matrix(rrr_hw6[,table2_hw6[,1]]) %*% x_no_short_hw6 + 1)^(1/60) - 1

```

\noindent Thus, $r_g = 0.01899447$.  

\noindent 4. Constant Correlation Model when short sales are allowed.

```{r}

prod(as.matrix(r_hw6[,-1]) %*% x_with_short_ccm_hw6 + 1)^(1/60) - 1

```

\noindent Thus, $r_g = -0.01271753$.  

\noindent 5. Constant Correlation Model when short sales are NOT allowed.  

```{r}

prod(as.matrix(rrr_hw6[,table_ccm_4_hw6[1:13,1]]) %*% x_no_short_ccm_hw6 + 1)^(1/60) - 1

```

\noindent Thus, $r_g = 0.01794777$.  

#### 3.  

\noindent Sharpe ratio $$ = \frac{\bar{R_p} - R_F}{\sigma_p}$$, suppose $r_f = 0.001$.   

\noindent 1. Multi-group model.

```{r}

rf_3 <- 0.001

(mean(as.matrix(r_group[-1]) %*% x) - rf_3) / sd(as.matrix(r_group[-1]) %*% x)

```

\noindent Thus, $S_1 = 0.5070449$.  

\noindent 2. General model when short sales are allowed.  

```{r}

(mean(as.matrix(rrr_hw6[,table1_hw6[,1]]) %*% x_short_hw6) - rf_3) / sd(as.matrix(rrr_hw6[,table1_hw6[,1]]) %*% x_short_hw6)

```

\noindent Thus, $S_2 = 0.6178993$.  

\noindent 3. General model when short sales are NOT allowed.

```{r}

(mean(as.matrix(rrr_hw6[,table2_hw6[,1]]) %*% x_no_short_hw6) - rf_3) / sd(as.matrix(rrr_hw6[,table2_hw6[,1]]) %*% x_no_short_hw6)

```

\noindent Thus, $S_3 = 0.5430201$.  

\noindent 4. Constant Correlation Model when short sales are allowed.  

```{r}

(mean(as.matrix(r_hw6[,-1]) %*% x_with_short_ccm_hw6) - rf_3) / sd(as.matrix(r_hw6[,-1]) %*% x_with_short_ccm_hw6)

```

\noindent Thus, $S_4 = -0.1305454$.  

\noindent 5. Constant Correlation Model when short sales are NOT allowed.  

```{r}

(mean(as.matrix(rrr_hw6[,table_ccm_4_hw6[1:13,1]]) %*% x_no_short_ccm_hw6) - rf_3) / sd(as.matrix(rrr_hw6[,table_ccm_4_hw6[1:13,1]]) %*% x_no_short_ccm_hw6)

```

\noindent Thus, $S_5 = 0.4744805$.  

\noindent to find Differential Excess Return, we have to find market index, so-called the point $M$. 

```{r}

mean(r_hw7$X.GSPC) ; sd(r_hw7$X.GSPC)

(mean(r_hw7$X.GSPC) - rf_3) / sd(r_hw7$X.GSPC)

```

\noindent Thus, the regression line is $$\bar{R} = 0.2260897 \sigma + 0.001$$.

```{r}

(mean(r_hw7$X.GSPC) - rf_3) / sd(r_hw7$X.GSPC) * sd(r_hw7$X.GSPC) + 0.001 

```

\noindent Thus, the point $M$ is $(0.03446065, 0.008791199)$. 

\noindent 1. Multi-group model  

```{r}

mean(as.matrix(r_group[-1]) %*% x) ; sd(as.matrix(r_group[-1]) %*% x)

(mean(r_hw7$X.GSPC) - rf_3) / sd(r_hw7$X.GSPC) * sd(as.matrix(r_group[-1]) %*% x) + 0.001 

mean(as.matrix(r_group[-1]) %*% x) - ((mean(r_hw7$X.GSPC) - rf_3) / sd(r_hw7$X.GSPC) * sd(as.matrix(r_group[-1]) %*% x) + 0.001 )

```

\noindent Thus, $ D_1 = 0.008153795$.  

\noindent 2. General model when short sales are allowed.

```{r}

(mean(r_hw7$X.GSPC) - rf_3) / sd(r_hw7$X.GSPC) * sd(as.matrix(rrr_hw6[,table1_hw6[,1]]) %*% x_short_hw6) + 0.001 

mean(as.matrix(rrr_hw6[,table1_hw6[,1]]) %*% x_short_hw6) - ((mean(r_hw7$X.GSPC) - rf_3) / sd(r_hw7$X.GSPC) * sd(as.matrix(rrr_hw6[,table1_hw6[,1]]) %*% x_short_hw6) + 0.001 )

```

\noindent Thus, $D_2 = 0.02520799$.  

\noindent 3. General model when short sales are NOT allowed.  

```{r}

(mean(r_hw7$X.GSPC) - rf_3) / sd(r_hw7$X.GSPC) * sd(as.matrix(rrr_hw6[,table2_hw6[,1]]) %*% x_no_short_hw6) + 0.001 

mean(as.matrix(rrr_hw6[,table2_hw6[,1]]) %*% x_no_short_hw6) - ((mean(r_hw7$X.GSPC) - rf_3) / sd(r_hw7$X.GSPC) * sd(as.matrix(rrr_hw6[,table2_hw6[,1]]) %*% x_no_short_hw6) + 0.001 )

```

\noindent Thus, $D_3 = 0.0110343$.  

\noindent 4. Constant Correlation Model when short sales are allowed.

```{r}

(mean(r_hw7$X.GSPC) - rf_3) / sd(r_hw7$X.GSPC) * sd(as.matrix(r_hw6[,-1]) %*% x_with_short_ccm_hw6) + 0.001

mean(as.matrix(r_hw6[,-1]) %*% x_with_short_ccm_hw6) - ((mean(r_hw7$X.GSPC) - rf_3) / sd(r_hw7$X.GSPC) * sd(as.matrix(r_hw6[,-1]) %*% x_with_short_ccm_hw6) + 0.001)

```

\noindent Thus, $D_4 = -0.02902117$.  

\noindent 5. Constant Correlation Model when short sales are NOT allowed.  

```{r}

(mean(r_hw7$X.GSPC) - rf_3) / sd(r_hw7$X.GSPC) * sd(as.matrix(rrr_hw6[,table_ccm_4_hw6[1:13,1]]) %*% x_no_short_ccm_hw6) + 0.001

mean(as.matrix(rrr_hw6[,table_ccm_4_hw6[1:13,1]]) %*% x_no_short_ccm_hw6) - ((mean(r_hw7$X.GSPC) - rf_3) / sd(r_hw7$X.GSPC) * sd(as.matrix(rrr_hw6[,table_ccm_4_hw6[1:13,1]]) %*% x_no_short_ccm_hw6) + 0.001)

```

\noindent Thus, $D_5 = 0.009395201$.  

\noindent Treynor Measure $$ = \frac{\bar{R_B} - R_F}{\beta_B}$$.  

\noindent 1. Multigroup Model

```{r}

lm_treynor_1 <- lm(r_hw7$X.GSPC~as.vector(as.matrix(r_group[-1]) %*% x))

beta_treynor_1 <- lm_treynor_1$coefficients[2]

(mean(as.matrix(r_group[-1]) %*% x) - rf_3) / beta_treynor_1

```

\noindent Thus, $T_1 = 0.01450103$.  

\noindent 2. General Model when short sales are allowed.  

```{r}

lm_treynor_2 <- lm(r_hw7$X.GSPC~as.vector(as.matrix(rrr_hw6[,table1_hw6[,1]]) %*% x_short_hw6))

beta_treynor_2 <- lm_treynor_2$coefficients[2]

(mean(as.matrix(rrr_hw6[,table1_hw6[,1]]) %*% x_short_hw6) - rf_3) / beta_treynor_2

```

\noindent Thus, $T_2 = 0.3388127$.  

\noindent 3. General Model when short sales are NOT allowed.  

```{r}

lm_treynor_3 <- lm(r_hw7$X.GSPC~as.vector(as.matrix(rrr_hw6[,table2_hw6[,1]]) %*% x_no_short_hw6))

beta_treynor_3 <- lm_treynor_3$coefficients[2]

(mean(as.matrix(rrr_hw6[,table2_hw6[,1]]) %*% x_no_short_hw6) - rf_3) / beta_treynor_3

```

\noindent Thus, $T_3 = 0.02408695$.  

\noindent 4. Constant Correlation Model when short sales are allowed.  

```{r}

lm_treynor_4 <- lm(r_hw7$X.GSPC~as.matrix(r_hw6[,-1]) %*% x_with_short_ccm_hw6)

beta_treynor_4 <- lm_treynor_4$coefficients[2]

(mean(as.matrix(r_hw6[,-1]) %*% x_with_short_ccm_hw6) - rf_3) / beta_treynor_4

```

\noindent Thus, $T_4 = -0.04284463$.  

\noindent 5. Constant Correlation Model when short sales are NOT allowed.  

```{r}

lm_treynor_5 <- lm(r_hw7$X.GSPC~as.matrix(rrr_hw6[,table_ccm_4_hw6[1:13,1]]) %*% x_no_short_ccm_hw6)

beta_treynor_5 <- lm_treynor_5$coefficients[2]

(mean(as.matrix(rrr_hw6[,table_ccm_4_hw6[1:13,1]]) %*% x_no_short_ccm_hw6) - rf_3) / beta_treynor_5

```

\noindent Thus, $T_5 = 0.02435349$.  

\noindent to find Jensen differential performance index, we have to check market.  
Because $\beta_M = 1$, $M$ is on $(1, 0.008791199)$.  
Thus, $$\bar{R} = 0.007791199 \beta + 0.001$$.

\noindent 1. Multigroup Model.

```{r}

mean(as.matrix(r_group[-1]) %*% x) - (0.007791199 * beta_treynor_1 + 0.001)

```

\noindent Thus, $J_1 = 0.006808975$.  

\noindent 2. General Model when short sales are allowed.  

```{r}

mean(as.matrix(rrr_hw6[,table1_hw6[,1]]) %*% x_short_hw6) - (0.007791199 * beta_treynor_2 + 0.001)

```

\noindent Thus, $J_2 = 0.03883983$.  

\noindent 3. General Model when short sales are NOT allowed.  

```{r}

mean(as.matrix(rrr_hw6[,table2_hw6[,1]]) %*% x_no_short_hw6) - (0.007791199 * beta_treynor_3 + 0.001)

```

\noindent Thus, $J_3 = 0.01279055$.  

\noindent 4. Constant Correlation Model when short sales are allowed.  

```{r}

mean(as.matrix(r_hw6[,-1]) %*% x_with_short_ccm_hw6) - (0.007791199 * beta_treynor_4 + 0.001) 

```

\noindent Thus, $J_4 = -0.01255492$.  

\noindent 5. Constant Correlation Model when short sales are NOT allowed.  

```{r}

mean(as.matrix(rrr_hw6[,table_ccm_4_hw6[1:13,1]]) %*% x_no_short_ccm_hw6) - (0.007791199 * beta_treynor_5 + 0.001)

```

\noindent Thus, $J_5 = 0.01220529$.  

#### 4.

\noindent 3. General Model when short sales are NOT allowed.

```{r}

x <- seq(-0.3, 4, by=0.001)
y <- 0.001 + 0.007791199 * x

plot(x, y, type='l', xlab='beta', ylab='expected return', main='Fama\'s decomposition')
points(1, mean(r_hw7$X.GSPC), pch=16, col='darkgreen')
points(beta_treynor_3, mean(as.matrix(rrr_hw6[,table2_hw6[,1]]) %*% x_no_short_hw6), pch=16)
points(beta_treynor_3, 0.007791199 * beta_treynor_3 + 0.001, pch=16)
abline(v=beta_treynor_3, lty='dashed')
abline(h=0.007791199 * beta_treynor_3 + 0.001, lty='dashed')
abline(h=mean(as.matrix(rrr_hw6[,table2_hw6[,1]]) %*% x_no_short_hw6), lty='dashed')
abline(h=0.001 + 0.007791199 * 1, lty='dashed', col='green')
text(0.63, 0.022, 'A')
text(0.68, 0.01, 'Market', col='darkgreen')
text(0.63, 0.005, 'A\'')

selectivity_3 <- mean(as.matrix(rrr_hw6[,table2_hw6[,1]]) %*% x_no_short_hw6) - (0.007791199 * beta_treynor_3 + 0.001)
net_selectivity_3 <- mean(as.matrix(rrr_hw6[,table2_hw6[,1]]) %*% x_no_short_hw6) - (0.001 + 0.007791199 * 1)
diversification_3 <- (0.001 + 0.007791199 * 1) - (0.007791199 * beta_treynor_3 + 0.001)

selectivity_3 ; net_selectivity_3 ; diversification_3

```

\noindent Thus, $0.01279055 = 0.01111468 + 0.001675877$.  

\noindent 5. Constant Correlation Model when short sales are NOT allowed.

```{r}

plot(x, y, type='l', xlab='beta', ylab='expected return', main='Fama\'s decomposition')
points(1, mean(r_hw7$X.GSPC), pch=16, col='darkgreen')
points(beta_treynor_5, mean(as.matrix(rrr_hw6[,table_ccm_4_hw6[1:13,1]]) %*% x_no_short_ccm_hw6), pch=16)
points(beta_treynor_5, 0.007791199 * beta_treynor_5 + 0.001, pch=16)
abline(v=beta_treynor_5, lty='dashed')
abline(h=0.007791199 * beta_treynor_5 + 0.001, lty='dashed')
abline(h=mean(as.matrix(rrr_hw6[,table_ccm_4_hw6[1:13,1]]) %*% x_no_short_ccm_hw6), lty='dashed')
abline(h=0.001 + 0.007791199 * 1, lty='dashed', col='green')
text(0.63, 0.021, 'B')
text(0.68, 0.01, 'Market', col='darkgreen')
text(0.63, 0.005, 'B\'')

selectivity_5 <- mean(as.matrix(rrr_hw6[,table_ccm_4_hw6[1:13,1]]) %*% x_no_short_ccm_hw6) - (0.007791199 * beta_treynor_5 + 0.001)
net_selectivity_5 <- mean(as.matrix(rrr_hw6[,table_ccm_4_hw6[1:13,1]]) %*% x_no_short_ccm_hw6) - (0.001 + 0.007791199 * 1)
diversification_5 <- (0.001 + 0.007791199 * 1) - (0.007791199 * beta_treynor_5 + 0.001)

selectivity_5 ; net_selectivity_5 ; diversification_5

```

\noindent Thus, $0.01220529 = 0.01015568 + 0.002049611$.